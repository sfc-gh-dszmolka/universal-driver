---
description: rules for writing and editing rust error handling code
alwaysApply: false
---
# Rust Error Handling Rules with Snafu


## Core Directive
Always use the snafu crate for all error handling within Rust files.

For every new module, you should create a separate error enum to handle all potential errors. If necessary, one module can have more than one error enum, but no more than three.


## Error Enum Formatting

All error enums must have the `#[derive(Snafu, Debug)]` attribute.

Each variant must include a `#[snafu(display(...))]` attribute with a descriptive, human-readable error message.

The `source` field is mandatory when the error originates from an external crate or a different error type.

The `location` field is also mandatory for all variants and must be marked with `#[snafu(implicit)]` to automatically capture the error's location.

*Example*:

```
#[derive(Snafu, Debug)]
pub enum FileManagerError {
    #[snafu(display("Failed to read or write file"))]
    Io {
        source: std::io::Error,
        #[snafu(implicit)]
        location: Location,
    },
    #[snafu(display("Failed to encrypt data"))]
    Encryption {
        source: EncryptionError,
        #[snafu(implicit)]
        location: Location,
    },
    #[snafu(display("Failed to decrypt data"))]
    Decryption {
        source: EncryptionError,
        #[snafu(implicit)]
        location: Location,
    },
    #[snafu(display("Failed to compress data"))]
    Compression {
        source: CompressionError,
        #[snafu(implicit)]
        location: Location,
    },
    #[snafu(display("Failed to upload file to S3"))]
    S3Upload {
        source: UploadFileError,
        #[snafu(implicit)]
        location: Location,
    },
    #[snafu(display("Failed to download file from S3"))]
    S3Download {
        source: DownloadFileError,
        #[snafu(implicit)]
        location: Location,
    },
    #[snafu(display("Failed to expand file paths"))]
    PathExpansion {
        source: PathExpansionError,
        #[snafu(implicit)]
        location: Location,
    },
    #[snafu(display("Failed to guess compression type"))]
    CompressionTypeGuess {
        source: CompressionTypeError,
        #[snafu(implicit)]
        location: Location,
    },
}
```


## Error Enum Naming

Error enums must have a `Error` suffix.
*Examples*: FileManagerError, EncryptionError, CompressionError


## Error Variant Naming

Error variant names should generally be nouns.

When a process fails, the variant should be named after the process itself. Skip the `Failed` suffix.
*Examples*: Communication, Decompression, Authorization

For other types of errors, use a descriptive noun, often with an adjective.
*Examples*: UnsupportedType, InvalidStateTransition, PermissionDenied

