[tox]
requires = tox-uv>=1.8
env_list =
  lint, type,
  py{39,310,311,312,313}-unit,
  py{39,310,311,312,313}-all,
  py{39,310,311,312,313}-integ,
  py{39,310,311,312,313}-e2e,
  py{39,310,311,312,313}-reference

[testenv]
# Pass through all environment variables (needed for CORE_PATH, PARAMETER_PATH, etc.)
passenv = *
# Use test dependencies from pyproject.toml
deps = .[test]
commands = uv run pytest tests -q {posargs}

[testenv:lint]
deps = .[dev]
commands = uv run flake8 pep249_dbapi

[testenv:type]
deps = .[dev]
commands = uv run mypy pep249_dbapi

[testenv:py{39,310,311,312,313}-unit]
commands = uv run pytest tests/unit {posargs}

[testenv:py{39,310,311,312,313}-all]
commands = uv run pytest tests/ --connector=universal {posargs}

[testenv:py{39,310,311,312,313}-integ]
commands = uv run pytest tests/integ --connector=universal {posargs}

[testenv:py{39,310,311,312,313}-e2e]
commands = uv run pytest tests/e2e --connector=universal {posargs}

[testenv:py{39,310,311,312,313}-reference]
# Isolated - don't install our local package - only test dependencies and reference connector
skip_install = true
deps =
    # Core test dependencies - required due to skip_install
    pytest>=8
    pytest-xdist
    pytest-json-report
    pytest-split
    hypothesis
    # Compression libs used in PUT/GET tests
    brotli
    zstandard
    # Reference connector with version from environment or default
    snowflake-connector-python=={env:REFERENCE_DRIVER_VERSION:3.17.2}
commands = uv run pytest tests/integ tests/e2e --connector=reference {posargs}